<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Piratwhist – Regler v0.2.67</title>
  <link rel="stylesheet" href="piratwhist.css" />
</head>
<body>
  <header class="topbar">
    <div class="title">
      Piratwhist – Regler <span class="badge">v0.2.67</span>
    </div>
    <div class="actions">
      <button id="rulesBack" class="ghost linkbtn" type="button">← Tilbage</button>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <h2>Grundidé</h2>
      <p>
        Piratwhist er et stikspil for <strong>2–8 spillere</strong>.
        I hver runde afgiver hver spiller et <strong>bud</strong> på, hvor mange stik de forventer at tage.
        Når runden er spillet færdig, indtastes hvor mange stik hver spiller <strong>faktisk</strong> tog,
        og der beregnes point.
      </p>

      <h2>Rum (multiplayer)</h2>
      <ul>
        <li>Opret et rum og del koden med de andre.</li>
        <li>Alle i rummet ser samme opsætning, bud, stik og point i real-time.</li>
        <li>Hvis en runde ikke er udfyldt for alle spillere, tæller den ikke med i point endnu.</li>
      </ul>

      <h2>Opsætning</h2>
      <ul>
        <li>Vælg antal spillere (2–8) og indtast navne.</li>
        <li>Vælg antal runder (4–14). Appen viser rundens maksimum for stik.</li>
        <li><strong>0</strong> er altid et gyldigt bud.</li>
      </ul>

      <h2>Maks-stik pr. runde (14 runder)</h2>
<p class="sub">7, 6, 5, 4, 3, 2, 1, 1, 2, 3, 4, 5, 6, 7</p>

<h2>Runde-forløb</h2>
      <ol>
        <li>Alle spillere indtaster deres <strong>bud</strong> (0..max).</li>
        <li>Runden spilles med fysiske kort.</li>
        <li>Alle spillere indtaster deres <strong>stik</strong> (0..max).</li>
      </ol>

      <h2>Hvornår tæller en runde?</h2>
      <p>
        En runde tæller først med i point, når <strong>alle spillere</strong> har indtastet både bud og stik.
        Hvis et felt er tomt for nogen spiller, regnes runden som <em>ikke færdig</em> og giver 0 point til alle
        indtil den er udfyldt.
      </p>

      <h2>Point</h2>
      <ul>
        <li>Hvis du rammer dit bud præcist: <strong>10 point + dit bud</strong>.</li>
        <li>Hvis du ikke rammer dit bud: <strong>-1 point</strong> for hvert stik du er fra det aktuelle bud
          (<code>-abs(stik - bud)</code>).</li>
      </ul>

      <h2>Vinder</h2>
      <p>
        Efter sidste runde vinder den spiller med <strong>flest samlede point</strong>.
      </p>
    </section>
  </main>

  <footer class="footer">
    Piratwhist v0.2.67
  </footer>

  <script>
    (function(){
      function sameOrigin(url){
        try { return new URL(url, window.location.href).origin === window.location.origin; } catch(e){ return false; }
      }
      function getParam(name){
        try { return new URLSearchParams(window.location.search).get(name); } catch(e){ return null; }
      }
      const fromParam = getParam('from');
      let storedReturn = null;
      try { storedReturn = sessionStorage.getItem('pw_rules_return'); } catch(_) { storedReturn = null; }
      let fallback = 'piratwhist.html';
      if (storedReturn && sameOrigin(storedReturn)) {
        fallback = storedReturn;
      } else if (fromParam) {
        try { fallback = decodeURIComponent(fromParam); } catch(e){ fallback = fromParam; }
      } else if (document.referrer && sameOrigin(document.referrer)) {
        fallback = document.referrer;
      }

      document.getElementById('rulesBack')?.addEventListener('click', () => {
        // Preferred: browser back (returns to the exact state, incl. mid-game).
        if (document.referrer && sameOrigin(document.referrer) && history.length > 1) {
          history.back();
          return;
        }
        // Fallback: explicit URL.
        window.location.href = fallback;
      });

      // Clear stored return once we've used the rules page (prevents stale returns later)
      try { sessionStorage.removeItem('pw_rules_return'); } catch(_) {}

      // If the rules page was opened in a new tab, the user might "close" the tab.
      // Provide a safe close attempt via ESC (optional):
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          try { window.close(); } catch(_) {}
          // If closing is blocked, navigate back instead.
          window.location.href = fallback;
        }
      });
    })();
  </script>
</body>
</html>
